<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Datatype Demo</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.2/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.2/dist/leaflet.js"></script>
    <script src="L.UTFGrid-min.js"></script>
</head>

<body>
<div class="container">
    <h3>Datatype Demo</h3>
    <div id="map" style="width: 800px; height: 800px"></div>
    <div>
        <form id="layer-selector">
            <input type="radio" name="layer" id="pwd_inlets" value="pwd_inlets">
            <label for="pwd_inlets">pwd_inlets (POINT)</label>

            <input type="radio" name="layer" id="street_centerline" value="street_centerline">
            <label for="street_centerline">street_centerline (MULTILINESTRING)</label>

            <input type="radio" name="layer" id="pwd_parcels" value="pwd_parcels">
            <label for="pwd_parcels">pwd_parcels (MULTIPOLYGON)</label>
        </form>
    </div>
</div>
<style>
    #map {
        border: 1px solid rgba(0, 0, 0, 0);
        border-radius: 6px;
        display: inline-block;
    }

    .container {
        width: 100%;
        margin-top: 30px;
        align-content: center;
        text-align: center;
    }
</style>
<script>
    "use-strict"

    document.addEventListener('DOMContentLoaded', function onload() {
        // create map object
        var map = L.map('map', {
            center: [39.96, -75.15], zoom: 12
        });

        // add tileserver
        // un-comment out the path that you want to test

        //var TILESERVER_PATH = 'https://d28f32z0lbuk2f.cloudfront.net/';
        var TILESERVER_PATH = 'http://localhost:9001/';

        L.tileLayer(TILESERVER_PATH + '/tile/{z}/{x}/{y}.png').addTo(map);
        // Create/add tile layers
        function createLayer(ownerName) {
            lyr = L.tileLayer(TILESERVER_PATH + '/tile/{z}/{x}/{y}.png?layers=' + ownerName);

            return {
                layer: lyr,
            }
        }

        const layerNames = ['pwd_inlets', 'pwd_parcels', 'street_centerline']
        const layerKeys = Object.assign({}, ...layerNames.map(function(key) {
            return {[key]: createLayer(key)}
        }))

        document.querySelectorAll("#layer-selector input").forEach(function (item) {
            item.addEventListener('change', function() {
                // Can't listen for unchecked event
                layerNames.forEach(function(l) {
                    map.removeLayer(layerKeys[l].layer)
                })

                if (this.checked) {
                    console.log("Adding layer " + this.value);
                    map.addLayer(layerKeys[this.value].layer);
                }
            });
        });

        // add basemap
        var basemap = L.tileLayer('https://korona.geog.uni-heidelberg.de/tiles/roadsg/x={x}&y={y}&z={z}', {
            maxZoom: 19,
            attribution: 'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        map.addLayer(basemap)
    });
</script>
</body>

</html>
