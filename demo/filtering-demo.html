<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>PWD Inlets</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.2/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.2/dist/leaflet.js"></script>
    <script src="L.UTFGrid-min.js"></script>
</head>

<body>
<div class="container">
    <h3>PWD Inlets</h3>
    <div id="map" style="width: 705px; height: 375px"></div>
    <div>
        <input type="checkbox" id="all" value="all">
        <label for="all">All</label>

        <span id="layer-selector">
            <input type="checkbox" id="pwd" value="PWD">
            <label for="pwd">PWD</label>

            <input type="checkbox" id="state" value="STATE">
            <label for="state">STATE</label>

            <input type="checkbox" id="park" value="PARK">
            <label for="park">PARK</label>

            <input type="checkbox" id="airprt" value="AIRPRT">
            <label for="airprt">AIRPRT</label>

            <input type="checkbox" id="lm" value="LM">
            <label for="lm">LM</label>

            <input type="checkbox" id="federal" value="FEDERAL">
            <label for="federal">FEDERAL</label>

            <input type="checkbox" id="priv" value="PRIV">
            <label for="priv">PRIV</label>
        </span>
    </div>
</div>
<style>
    #map {
        border: 1px solid rgba(0, 0, 0, 0);
        border-radius: 6px;
        display: inline-block;
    }
    .container {
        width: 100%;
        margin-top: 30px;
        align-content: center;
        text-align: center;
    }
</style>
<script>
    "use-strict"
    document.addEventListener('DOMContentLoaded', function onload() {
        // create map object
        var map = L.map('map', {
            center: [39.96, -75.15], zoom: 12
        });
        // add tileserver
        // un-comment out the path that you want to test
        //var TILESERVER_PATH = 'https://d28f32z0lbuk2f.cloudfront.net/';
        var TILESERVER_PATH = 'http://localhost:9001/';
        // Create/add tile layers
        function createLayer(ownerName) {
            lyr = L.tileLayer(TILESERVER_PATH + '/tile/{z}/{x}/{y}.png?layers=' + ownerName);
            grd = L.utfGrid(TILESERVER_PATH + "/grid/{z}/{x}/{y}?utfFields=inlettype&layers=" + ownerName, {
                useJsonP: false
            });
            grd.on('click', function(e) {
                if (e.data) {
                    alert("This inlet is of type " + e.data.inlettype);
                }
            });
            return {
                layer: lyr,
                grid: grd,
            }
        }
        const layerNames = ['PWD', 'STATE', 'PARK', 'AIRPRT', 'LM', 'FEDERAL', 'PRIV']
        const layerKeys = Object.assign({}, ...layerNames.map(function(key) {
            return {[key]: createLayer(key)}
        }))
        document.querySelectorAll("#layer-selector input").forEach(function (item) {
            item.addEventListener('click', function() {
                if (this.checked) {
                    console.log("Adding layer " + this.value);
                    map.addLayer(layerKeys[this.value].layer);
                    map.addLayer(layerKeys[this.value].grid);
                }
                else {
                    console.log("Removing layer " + this.value);
                    map.removeLayer(layerKeys[this.value].layer);
                    map.removeLayer(layerKeys[this.value].grid);
                }
            })
        })
        document.getElementById("all").addEventListener('click', function() {
            console.log('Toggled all buttons.')
            var checked = this.checked;
            document.querySelectorAll("#layer-selector input").forEach(function (checkbox) {
                if (checkbox.checked != checked) checkbox.click();
            });
        });
        // add basemap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);
    });
</script>
</body>

</html>
